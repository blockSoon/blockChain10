# 이더리움

- 우리가 블록체인을 배우면서
- 만든 사람에게 배우는게 최고
- 이더리움을 만든 천재
- 비탈릭 부테린

- 이더리움 백서

# 차세대 스마트 컨트랙트와 탈중앙화된 어플리케이션 플랫폼

- 비트코인의 보완을 좀더 신경쓴거 같은 느낌
- 비트코인을 백서에서 많이 언급을 한다.
- 비트코인과 다른 내용들을 확인할수 있는데 이름만 바꿔서 사용하거나

- 비트코인은 결제라는 포커스에 맞춰서 구현을 했다면
- 이더리움은 탈중앙화된 어플리케이션을 제안 한다고 보면된다.
- 여기서 중요한 내용은 스마트 컨트랙트와 어플리케이션이라는 키워드

- 비트코인이 결제에 포커스가 맞춰져 있다면
- 이더리움은 결제에 대한 포커스가 아니다.

- 백서의 내용을 보면

- 블록체인 기술을 사용한 대안적인 어플리케이션이 두가지가 있는데
- 사용자 저의 화폐와 금융 상품을 블록체인 위로 표현하기 위한 컬러드 코인
- 물리적 대상의 소유권을 표현하는 스마트 자산
- 도메인 이름과 같은 비동질적 자산을 기록하는 네임 코인

- 임의적인 계약의 규칙을 구현한 코드에 의해 디지털 자산을 좀더 관리하는게 편하도록
- 스마트 컨트랙트를 만들고
- 더나아가 블록체인을 기반으로한 자율조직 DAO 등이 있다.

- 이더리움은 완벽한 튜링완전 프로그래밍 언어가 심어진 블록 체인이다.
- 튜링 완전 이라는 내용은 나중에 궁금할때 엘런 튜링 이라는 사람을 알아보자
- 간단히 말해서 : 계산 가능한 문제를 해결할 수 있는 모든 기계의 공통된 능력

- 이 프로그래밍 언어는 코딩된 규칙에 따라 어떤 상태를 다르게 변환 시키는 기능이 포함된 계약을 누가 만든다? 유저들이 편하게 코드로 작성할 수 있게 해서 위에서 설명한 시스템을 구현 가능하게 도와준다.

- 역사(비트코인)
- 과거에 비트코인과 비슷하게 암호화폐를 만들려고 시도는 했는데
- 중앙화 되어있던 데이터 의존, 조명을 받기가 힘들었다
- 탈중앙화의 개념을 제안하는걸 계속 시도를 했고 번번히 실패하다가
- 사토시 나카모토가 합의 알고리즘 POW의 사용으로 탈중앙화를 실현 시켰다.

- 비탈릭 부테린은
- 작업증명의 2가지 문제를 동시에 해결했다고 한다.

1. 아주 간단하고, 효과가 좋은 합의 알고리즘을 제고
2. 누구나 합의 프로세스에 참여할수 있다

- 이후에 지분 증명(POS)라는 새로운 방식의 합의 알고리즘이 등장
- POW
- 화폐의 보유량에 따라 각 노드의 결정된 정도를 계산하는것.
- 결국은 이더리움은 지분증명을 선택

# 상태 변환 시스템으로 비트코인

- 이더리움 백서에서는 비트코인의 트랜잭션을 상태 변환 시스템이라고 말하고 있다.
- 비트코인의 트랜잭션은 UTXO에 객체가 생성되는데 이더리움은 트랜잭션을 상태 처리라고 하고있다.

- 우리가 배운 내용에서 쉽게 보자면 추상적으로 리액트의 상태 라고 봐도 무방하다.

- 상태를 간단히 설명하면

- 쇼핑몰을 만들고
- 상품을 구매하는 프로세스
- 상품의 현재 상태를 보여줄 테이블을 하나 만들었다.
- 상품의 테이블에는 주문이라는 상태가 있고

- 주문 접수 -> 결제 확인 -> 상품을 준비 -> 상품을 발송 -> 배송 완료 -> 상품 수령

- order -> state

- UTXO -> Transaction -> UTXO

- 우리가 UTXO를 통해 잔액을 확인하고 account들의 balance를 구하고
- 새로운 거래를 생성하여 트랜잭션 처리가 되면 새로운 UTXO를 만들어주었다.
- 비트코인에서 UTXO 변경되는 내용을 상태가 변한다라고 비유

# 스크립팅

- 비트코인 정말 낮은 수준의 스마트 컨트랙트같은 친구가 존재하는데
- 비탈릭 부테린은 서명에 관련된 로직을 스마트 컨트랙트라는 시점으로 바라보고 있다.

- 비트코인의 UTXO는 공개키만으로 해당 계정의 잔액을 조회할수 있는데
- 단순 스택의 기반으로 프로그래밍 언어로 표현되어 있는데.

- 비트코인에서 2,3개의 개인키를 가지고 서명을 만들어서 검증을 할수 있도록 간단한 스크립팅을 작성할 수 있다.(어렵기 때문에, 실용성이 떨어짐.)

- 그래서 이더리움은 이내용을 스마트 컨트랙트 개념을 바라보고 제안을 했다.

# 이더리움

- 이더리움을 짧게 문자으로 서술했을때
- 이더리움은 목적은 분산 어플리케이션 제작을 위한 대체 프로토콜

- 이렇게 생산하는 이유는

1. bitcoin을 가지고 예금, 보험 및 금융 상품에 대한 것을 구현할수가 없다.(이자 구현 X)
2. 사이트 및 게임에 적용하기 힘든 부분들이 많다(상품 및 게임 아이템 매칭 X)

- 비트코인은 결제에 포커스가 맞춰져 있기 때문에 결제에 대한 부분만 처리를 하고 있기 때문
- 이자의 부분은 따로 구현을 해서 처리를 하는 방향이 맞다고 생각한것.

- 그래서 이더리움은 이부분을 보완을 해서 이더리움이라는 플랫폼을 만든것.
- 적은 시간을 들여서 탈중앙화 Dapp 즉 탈중앙화 데이터를 저장하는 사이트 등 게임을 만들수 있게 되었다.

- 탈중앙화랑 통신을 할수 있는 프로토콜을 유저가 쉽게 구현 할수 있도록 도와준다.
- 탈중앙화에 데이터를 저장할수 있다 === 스마트 컨트랙트

- 비트코인의 UTXO 형식적인 데이터가 아닌 상태를 즉 상태의 변화를 만들어서, 다양한 데이터를 저장하고 사용할 수 있도록 트랜잭션의 구조가 완전히 바뀐것.

# 이더리움 어카운트

- 이더리움에서는 상태(state)는 account라고 하는 객체로 구성이 되어있다.

- 토이 비트코인에서 만들었던
- 개인키, 공개키 만들고 26자리 자른 40자리 문자열이 account

```javascript
interface Account {
  nonce: number; // 블록에 있던 내용이 아닌 (이 계정이 트랜잭션 발생 횟수, 이중 지불 방지용도로 사용한다.)
  balance: string; // 이더
  storageRoot: string; // account의 상태 저장 공간 초기에는 비어있다.
  codeHash: string; // 스마트 컨트랙트 계약의 코드
}
```

- 이더라는 이더리움 플랫폼의 화폐 단위가 있고

- 트랜잭션을 발생 시킬때 수수료를 지불 하는데 사용한다.
- 이더리움 네트워크에서 이더라는 자원이 없으면 코드를 실행할수 없게 하기 위해서.
- 데이터 저장할수도 없는것.

```javascript
// EOA
// 우리의 자산을 관리할수 있는 지갑처럼 사용할수 있는 계정의 형태
interface Account {
  nonce: number; // EOA가 사용
  balance: string; // 이더
  storageRoot: string; // 사용 X
  codeHash: string; // 사용 X
}

// CA 4가지의 속성을 모두 사용하는 것이 CA 계정이다.
interface Account {
  nonce: number;
  balance: string;
  storageRoot: string;
  codeHash: string;
}
```

- 반대로 CA
- CA 계정은 Account 객체 구조에 있는 모든 속성을 사용한다.
- 스마트 컨트랙트 코드를 솔리디티 언어를 사용해서 코드를 작성할것.

```javascript
class testContreact{
    let value : number
}
contract testContreact {
    uint256 value; // 상태변수
    function setValue(uint256 newValue) public {
        value = newValue // 상태 변수를 변경
        // 상태를 전환한다.
        // 상태 변수 바꿀거면 데이터 저장공간을 사용한다는 얘기인데 네트워크 자원을 사용한다.
        // 수수료 지불해 GAS fee
    }

    function getValue() public view retruns (uint256) {
        retrun value;
        // 조회할때는 트랜잭션이 발생하지 않음 상태 변수 변환은 안된다.
        // 수수료가 발생하지 않는다.
    }
}
```

- 이때 codehash 들은 코드를 컴파일해서 바이너리 코드 내용을 저장한다.
- storageRoot에 value 상태 변수를 키와 값의 형태로 데이터 저장한다.

- 그리고 CA는 메시지를 보낼수 있다.
- 개인키가 존재하지 않아서 서명을 만들수 없음.. ㅠ 트랜잭션을 발생시킬수 없다.


# 메시지와 트랜잭션

- 이더리움에서는 서명이 있는 영수증 트랜잭션이라고 말하고
- 서명이 없는 영수증은 Message라고 말한다.

- EOA -> Transaction
- CA -> Message

```javascript
interface Message {
    from : string; // 보내는 계정
    to : string; // 받는 계정
    gas : number; // 메시지를 처리하기 위한 가스의 량
    gasPrice : number; // 가스당 가격
    value : number; // 메시지와 함께 전송할 이더량
    data : string; // 메시지의 데이터
    nonce : number; // 메시지를 전송한 account의 nonce 값
}

interface Transacion extends Message {
    v : number; // 공개키 복구 내용
    r : string; // 서명의 r 값 (n 정수 * 기준점 (secp256k1))
    s : string; // 서명의 s 값 (개인키와 r의 값을 포함시켜 방정식을 통해 만든 값)
}
```

- 이더리움 GAS
- EVM상의 트랜잭션을 처리하기위해 소모되는 자원
- 코드의 복잡성에 따라서 측정이 된다. 즉 GAS는 낭비를 막기위해 사용되고 채굴자들의 보상으로도 사용된다 GAS fee
- 이 GAS의 가격은 거래가 걸리는 시간에도 영향을 준다.
- GAS의 총량 * GAS당의 가격
- 사용자가 GAS당의 가격을 설정함으로 수수료를 조정할 수 있다.
- 이더리움의 단위중 가스를 계산하기 위해 사용하는 단위가 gwei의 단위는 1ETH = 1,000,000,000 Gwei 
- GAS 당의 가격이 21,000 * 100 === 2,100,000 Gwei === 0.0021ETH 가 가스 수수료
- 정확한건 아니지만 byte당 5gas로 추정된다.